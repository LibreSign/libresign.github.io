openapi: 3.0.0
info:
  title: LibreSign API
  description: Libre digital signature app for Nextcloud.
  contact:
    name: Support
    url: 'https://github.com/LibreSign/libresign/issues'
  license:
    name: AGPLv3
    url: 'https://www.gnu.org/licenses/agpl-3.0.en.html'
  version: 2.2.2
servers:
  - description: local
    url: 'http://localhost/apps/libresign/api/0.1'
tags:
  - name: account
    description: Account
  - name: identification documents
    description: Account identification documents
  - name: account signature elements
    description: Handle visible elements of account
  - name: sign
    description: Request and manage files to sign
  - name: sign validate
    description: Validate files
  - name: admin
    description: Admin settings
paths:
  /webhook/me:
    get:
      tags:
        - account
      summary: Who am I
      description: replaced by /account/me
      operationId: accountDeprecated#me
      security:
        - basicAuth: []
      deprecated: true
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  account:
                    allOf:
                      - $ref: '#/components/schemas/basicAccount'
                      - type: object
                        properties:
                          emailAddress:
                            type: string
                            format: email
                            description: Email of the person who owns the account
                            example: user@test.coop
                  settings:
                    $ref: '#/components/schemas/accountSettings'
                required:
                  - account
                  - settings
        '404':
          description: Invalid user or password
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    enum:
                      - Invalid user or password
                    example: Invalid user or password
                required:
                  - message
  /webhook/register:
    post:
      tags:
        - sign
      summary: Request signature
      description: replaced by /account/register
      operationId: signFileDeprecated#requestSign
      security:
        - basicAuth: []
      deprecated: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: filename
                  description: The name of file to sign
                file:
                  $ref: '#/components/schemas/newFile'
                users:
                  type: array
                  description: Collection of users who must sign the document
                  items:
                    type: object
                    description: Person who will sign
                    properties:
                      email:
                        type: string
                        format: email
                        description: Unique email to identify user
                        example: user@test.coop
                      displayName:
                        type: string
                        description: Persons name
                        nullable: true
                        example: John Doe
                      description:
                        type: string
                        description: Description that will be displayed to the person
                        example: 'As the company''s CEO, you must sign this contract'
                    required:
                      - email
                callback:
                  type: string
                  description: URL that will receive a POST after the document is signed
                  example: 'http://app.test.coop/callback_webhook'
              required:
                - name
                - file
                - users
        required: true
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: Success
                  data:
                    type: object
                    properties:
                      nodeId:
                        type: integer
                        description: Node id of a Nextcloud file
                        example: 2312
                      uuid:
                        type: string
                        format: uuid
                        description: File identifier. It is necessary to keep it because it must be used to update or delete a signature request and will also be used in the callback request.
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: User 0 needs an email address
    patch:
      tags:
        - sign
      summary: Updates signatures data
      description: Is necessary to inform the UUID of the file and a list of people
      operationId: signFileDeprecated#updateSign
      security:
        - basicAuth: []
      deprecated: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                uuid:
                  type: string
                  format: uuid
                  description: Received from sign request
                users:
                  type: array
                  description: Collection of users who must sign the document
                  items:
                    type: object
                    description: Person who will sign
                    properties:
                      email:
                        type: string
                        format: email
                        description: Unique email to identify user
                        example: user@test.coop
                      displayName:
                        type: string
                        description: Persons name
                        nullable: true
                        example: John Doe
                      description:
                        type: string
                        description: Description that will be displayed to the person
                        example: 'As the company''s CEO, you must sign this contract'
                    required:
                      - email
              required:
                - uuid
                - users
        required: true
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: Success
                  data:
                    type: object
                    properties:
                      nodeId:
                        type: integer
                        description: Node id of a Nextcloud file
                        example: 2312
                      uuid:
                        type: string
                        format: uuid
                        description: File identifier. It is necessary to keep it because it must be used to update or delete a signature request and will also be used in the callback request.
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: User 0 needs an email address
  /webhook/register/signature:
    delete:
      tags:
        - sign
      summary: Delete sign request
      description: replaced by /sign/register/signature
      operationId: signFileDeprecated#removeSign
      security:
        - basicAuth: []
      deprecated: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                uuid:
                  type: string
                  format: uuid
                  description: Received from sign request
                users:
                  type: array
                  description: Collection of persons
                  items:
                    type: object
                    description: Person who will deleted
                    properties:
                      email:
                        type: string
                        format: email
                        description: Unique email to identify user
                        example: user@test.coop
                    required:
                      - email
              required:
                - uuid
                - users
        required: true
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: Success
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: UUID not found
  /signature/has-root-cert:
    get:
      tags:
        - admin
      summary: Has root certificate
      description: Replaced by /setting/has-root-cert
      operationId: settingDeprecated#hasRootCert
      security:
        - basicAuth: []
      deprecated: true
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  hasRootCert:
                    type: boolean
                    example: true
  /account/me:
    get:
      tags:
        - account
      summary: Who am I
      description: Validates API access data and returns the authenticated user's data.
      operationId: account#me
      security:
        - basicAuth: []
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  account:
                    allOf:
                      - $ref: '#/components/schemas/basicAccount'
                      - type: object
                        properties:
                          emailAddress:
                            type: string
                            format: email
                            description: Email of the person who owns the account
                            example: user@test.coop
                  settings:
                    $ref: '#/components/schemas/accountSettings'
                required:
                  - account
                  - settings
        '404':
          description: Invalid user or password
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    enum:
                      - Invalid user or password
                    example: Invalid user or password
                required:
                  - message
  /account/settings:
    patch:
      tags:
        - account
      summary: Update account settings
      operationId: account#updateSettings
      security:
        - basicAuth: []
      description: Update account settings
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                phone:
                  type: string
                  example: '+123456789'
                  description: Phone number
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                description: ''
                type: object
                x-examples:
                  example-1:
                    status: success
                    data:
                      userId: admin
                      phone: ''
                      message: Settings saved
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    required:
                      - userId
                      - phone
                      - message
                    properties:
                      userId:
                        type: string
                        minLength: 1
                      phone:
                        type: string
                        description: 'Phone number, empty if invalid, filled if valid.'
                      message:
                        type: string
                        minLength: 1
                required:
                  - status
                  - data
        '400':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure on update visible element.
                  message:
                    type: string
                    description: Error pessage
                    example: Invalid type
                required:
                  - success
                  - message
  '/account/create/{uuid}':
    post:
      tags:
        - account
      summary: Create person account to sign a document
      description: Accounts can only be created to sign documents.
      operationId: account#createToSign
      parameters:
        - name: uuid
          in: path
          description: File UUID
          required: true
          schema:
            type: string
            format: uuid
            description: The user UUID is what the person receives via email when asked to sign. This is not the file UUID.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  description: Email of the person who owns the account
                  example: user@test.coop
                password:
                  type: string
                  format: password
                  description: Password used to authenticate to Nextcloud
                  example: password
                signPassword:
                  type: string
                  format: password
                  description: Password used to sign a document
                  example: password
              required:
                - email
                - password
      responses:
        '200':
          description: 'Success! When you create a person, they are automatically authenticated.'
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Success message
                    example: Success
                  action:
                    type: integer
                    description: Numeric code representing what action should be taken with the response
                    example: 250
                  pdf:
                    type: object
                    properties:
                      url:
                        type: string
                        description: URL to view PDF
                        example: 'http://cloud.test.coop/apps/libresign/pdf/46d30465-ae11-484b-aad5-327249a1e8ef'
                  filename:
                    type: string
                    example: filename
                    description: The name of file to sign
                  description:
                    type: string
                    nullable: true
                    description: Description for the person who will sign the document
                    example: 'As the company''s CEO, you must sign this contract'
                required:
                  - success
                  - message
                  - action
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure!
                  action:
                    type: integer
                    description: Numeric code representing what action should be taken with the response
                    example: 200
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: User 0 needs an email address
                required:
                  - success
                  - action
                  - message
  /account/files:
    post:
      tags:
        - identification documents
      summary: Save identification documents
      description: Save identification documents to account
      operationId: account#addFile
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                        pattern: '[A-Z0-9_]+'
                        example: PASSPORT
                        default: IDENTIFICATION
                        description: The type code of this file to be attached to the account
                      name:
                        type: string
                        example: filename
                        description: The name of file
                      file:
                        $ref: '#/components/schemas/newFile'
      responses:
        '200':
          description: Documents have been attached to the account
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                required:
                  - success
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Oh no!
                  messages:
                    type: array
                    items:
                      type: object
                      properties:
                        file:
                          type: integer
                          description: 'Sequential identifier of the file that failed, starting from file zero'
                        type:
                          type: string
                          enum:
                            - success
                            - info
                            - warning
                            - danger
                          description: Type of message
                        message:
                          type: string
                          description: Text of message
                          example: Invalid type
    get:
      tags:
        - identification documents
      summary: List account documents of owner
      operationId: account#accountFileListToOwner
      description: List all account documents to owner of documents
      security:
        - basicAuth: []
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    minItems: 0
                    items:
                      type: object
                      properties:
                        account:
                          $ref: '#/components/schemas/basicAccount'
                        files:
                          type: array
                          description: Files associated with account
                          items:
                            $ref: '#/components/schemas/libresignFile'
                  pagination:
                    $ref: '#/components/schemas/pagination'
    delete:
      summary: Delete identification document
      operationId: account#deleteFile
      security:
        - basicAuth: []
      description: Delete identification document of an account
      tags:
        - identification documents
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                nodeId:
                  type: integer
                  minimum: 1
                  description: NodeId of identification document
                  example: 1
              required:
                - nodeId
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Visible element deleted
                    example: Visible element deleted
                required:
                  - success
                  - message
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure on delete visible element.
                  message:
                    type: string
                    description: Error pessage
                    example: This isn't your element
                required:
                  - success
                  - message
  /account/files/approval/list:
    get:
      tags:
        - identification documents
      summary: List all account files - require permission to approve
      description: Identification document files can be associated with each account profile. Here you can list all these files and your status. The authenticated user need have permission to approve these documents.
      operationId: account#accountFileListToApproval
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/limitParam'
        - name: approved
          in: query
          schema:
            type: string
            enum:
              - 'yes'
              - 'no'
              - all
            default: 'no'
          description: Approved files
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    minItems: 0
                    items:
                      allOf:
                        - type: object
                          properties:
                            file_type:
                              $ref: '#/components/schemas/fileType'
                            account:
                              $ref: '#/components/schemas/basicAccount'
                            file:
                              $ref: '#/components/schemas/libresignFile'
                  pagination:
                    $ref: '#/components/schemas/pagination'
  /account/signature:
    post:
      tags:
        - account signature elements
      summary: Generates signature key
      description: Generates the personal signature key
      operationId: account#signatureGenerate
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                signPassword:
                  type: string
                  format: password
                  description: Password to pfx file
                  example: password
      responses:
        '200':
          description: Folder where the pfx file was saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  signature:
                    type: string
                    description: Folder where the pfx file was saved
                    example: /LibreSign
                required:
                  - success
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Password to sign is mandatory
                    example: Password to sign is mandatory
                  success:
                    type: boolean
                    description: Beep! Failure on generate certificate.
                required:
                  - success
  /account/signature/elements:
    post:
      tags:
        - account signature elements
      summary: Profile visible elements
      description: Add visible elements to profile. Signature or initials
      operationId: account#createSignatureElement
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              description: Collection of visible signature elements
              type: object
              properties:
                elements:
                  type: array
                  items:
                    allOf:
                      - $ref: '#/components/schemas/signatureElement'
                      - type: object
                        properties:
                          uid:
                            type: string
                            description: The account login to associate this element
                            example: jhondoe
                          starred:
                            type: boolean
                            default: false
                            description: The main signature
      responses:
        '200':
          description: Visible document saved with success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Success message
                    example: Success
                required:
                  - success
                  - message
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure on generate certificate.
                  message:
                    type: string
                    description: Error pessage
                    example: Invalid file
                required:
                  - success
                  - message
    get:
      tags:
        - account signature elements
      summary: Retrieve visible elements
      description: List all elements visible to user profile
      operationId: account#getSignatureElements
      security:
        - basicAuth: []
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/signatureElement'
                    - type: object
                      properties:
                        id:
                          type: integer
                          minimum: 1
                      required:
                        - id
        '404':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: Elements not found
  '/account/signature/elements/{elementId}':
    get:
      tags:
        - account signature elements
      summary: Retrieve visible elements
      description: Get a specific visible element from user profile
      operationId: account#getSignatureElement
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/elementIdParam'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/signatureElement'
                    - type: object
                      properties:
                        id:
                          type: integer
                          minimum: 1
                      required:
                        - id
    patch:
      tags:
        - account signature elements
      summary: Edit visible element
      description: Edit elements visible to user profile
      operationId: account#patchSignatureElement
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/elementIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/signatureElement'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Visible element upated
                    example: Visible element upated
                required:
                  - success
                  - message
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure on update visible element.
                  message:
                    type: string
                    description: Error pessage
                    example: Invalid type
                required:
                  - success
                  - message
    delete:
      tags:
        - account signature elements
      summary: Delete visible element
      description: Delete visible element of user
      operationId: account#deleteSignatureElement
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/elementIdParam'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Visible element deleted
                    example: Visible element deleted
                required:
                  - success
                  - message
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure on delete visible element.
                  message:
                    type: string
                    description: Error pessage
                    example: This isn't your element
                required:
                  - success
                  - message
  /sign/register:
    post:
      tags:
        - sign
      summary: Request signature
      description: Request that a file be signed by a group of people
      operationId: signFile#requestSign
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/libresignFileStatus'
                - type: object
                  properties:
                    name:
                      type: string
                      example: filename
                      description: The name of file to sign
                    file:
                      $ref: '#/components/schemas/newFile'
                    users:
                      type: array
                      description: Collection of users who must sign the document
                      items:
                        $ref: '#/components/schemas/signAccount'
                    callback:
                      type: string
                      description: URL that will receive a POST after the document is signed
                      example: 'http://app.test.coop/callback_webhook'
        required: true
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: Success
                  data:
                    type: object
                    properties:
                      nodeId:
                        type: integer
                        description: Node id of a Nextcloud file
                        example: 2312
                      uuid:
                        type: string
                        format: uuid
                        description: File identifier. It is necessary to keep it because it must be used to update or delete a signature request and will also be used in the callback request.
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: User 0 needs an email address
    patch:
      tags:
        - sign
      summary: Updates signatures data
      description: Is necessary to inform the UUID of the file and a list of people
      operationId: signFile#updateSign
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/libresignFileStatus'
                - type: object
                  properties:
                    uuid:
                      type: string
                      format: uuid
                      description: Received from sign request
                    file:
                      $ref: '#/components/schemas/fileId'
                    visibleElements:
                      type: array
                      description: Visible elements on document
                      items:
                        not:
                          required:
                            - coordinates
                        allOf:
                          - $ref: '#/components/schemas/pdfVisibleElement'
                          - type: object
                            properties:
                              elementId:
                                type: integer
                                minimum: 1
                                example: 1
                            required:
                              - elementId
                    users:
                      type: array
                      description: Collection of users who must sign the document
                      items:
                        $ref: '#/components/schemas/signAccount'
        required: true
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: Success
                  data:
                    type: object
                    properties:
                      nodeId:
                        type: integer
                        description: Node id of a Nextcloud file
                        example: 2312
                      uuid:
                        type: string
                        format: uuid
                        description: File identifier. It is necessary to keep it because it must be used to update or delete a signature request and will also be used in the callback request.
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: User 0 needs an email address
  /sign/register/signature:
    delete:
      tags:
        - sign
      summary: Delete sign request using a list of users
      description: Delete the request to sign using a list of users
      operationId: signFile#deleteSignature
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                uuid:
                  type: string
                  format: uuid
                  description: Received from sign request
                file:
                  $ref: '#/components/schemas/fileId'
                users:
                  type: array
                  description: Collection of persons
                  items:
                    type: object
                    description: Person who will deleted
                    properties:
                      email:
                        type: string
                        format: email
                        description: Unique email to identify user
                        example: user@test.coop
                    required:
                      - email
              required:
                - uuid
                - users
        required: true
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: Success
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: UUID not found
  '/sign/uuid/{uuid}':
    post:
      tags:
        - sign
      summary: Sign a file using user file UUUID
      description: The user UUID is what the person receives via email when asked to sign. This is not the file UUID.
      operationId: signFile#signUsingUuid
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/uuidParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
                  format: password
                  example: password
                elements:
                  type: array
                  description: 'Visible elements. Not mandatory, only needed when the document has visible elements and the user has many visible elements associated to profile and don''t has favorited visible element to use.'
                  items:
                    type: object
                    description: Relation between document visible element and visible element of user. This will be used to put on document.
                    properties:
                      documentElementId:
                        type: integer
                        description: Id of visible element on document
                      profileElementId:
                        type: integer
                        description: Id of visible element on document
                    required:
                      - documentElementId
                      - profileElementId
              required:
                - password
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  file:
                    type: object
                    description: LibreSign file
                    properties:
                      uuid:
                        type: string
                        format: uuid
                        description: LibreSign UUID
                  action:
                    type: integer
                    enum:
                      - 100
                      - 150
                      - 200
                      - 250
                      - 300
                      - 350
                      - 400
                    description: |-
                      Numeric code representing what action should be taken with the response

                      ACTION_REDIRECT = 100
                      ACTION_CREATE_USER = 150
                      ACTION_DO_NOTHING = 200
                      ACTION_SIGN = 250
                      ACTION_SHOW_ERROR = 300
                      ACTION_SIGNED = 350
                      ACTION_CREATE_SIGNATURE_PASSWORD = 400
                    example: 200
                  message:
                    type: string
                    enum:
                      - File signed
                    example: File signed
                required:
                  - success
                  - action
                  - message
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure!
                  action:
                    type: integer
                    description: Numeric code representing what action should be taken with the response
                    example: 200
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                      - File already signed by you
                required:
                  - success
                  - action
                  - errors
  '/sign/file_id/{fileId}':
    post:
      tags:
        - sign
      summary: Sign a file using Nextcloud node id
      description: Sign a file using Nextcloud node id.
      operationId: signFile#signUsingFileid
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/fileIdParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
                  format: password
                  example: password
                elements:
                  type: array
                  description: 'Visible elements. Not mandatory, only needed when the document has visible elements and the user has many visible elements associated to profile and don''t has favorited visible element to use.'
                  items:
                    type: object
                    description: Relation between document visible element and visible element of user. This will be used to put on document.
                    properties:
                      documentElementId:
                        type: integer
                        description: Id of visible element on document
                      profileElementId:
                        type: integer
                        description: Id of visible element on document
                    required:
                      - documentElementId
                      - profileElementId
              required:
                - password
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  file:
                    type: object
                    description: LibreSign file
                    properties:
                      uuid:
                        type: string
                        format: uuid
                        description: LibreSign UUID
                  action:
                    type: integer
                    description: Numeric code representing what action should be taken with the response
                    example: 200
                  message:
                    type: string
                    example: File signed
                required:
                  - success
                  - action
                  - message
        '422':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure!
                  action:
                    type: integer
                    description: Numeric code representing what action should be taken with the response
                    example: 200
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                      - File already signed by you
                required:
                  - success
                  - action
                  - errors
    delete:
      tags:
        - sign
      summary: Delete sign request
      description: You can only request exclusion as any sign
      operationId: signFile#deleteAllSignRequestUsingFileId
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/fileIdParam'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Success message
                    example: Success
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: UUID not found
  '/sign/file_id/{fileId}/{fileUserId}':
    delete:
      tags:
        - sign
      summary: Delete sign request of specific user
      description: You can only request exclusion as any sign
      operationId: signFile#deleteOneSignRequestUsingFileId
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/fileIdParam'
        - name: fileUserId
          in: path
          description: ID of relation between file and user.
          required: true
          schema:
            type: integer
            description: Each relation between file and user has an ID that is returned on validation endpoints.
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Success message
                    example: Success
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: Signer not associated to this file
  '/sign/uuid/{uuid}/token':
    post:
      tags:
        - account
      summary: Request sign code
      description: Request code to sign file using uuid
      operationId: signFile#getTokenUsingUuid
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/uuidParam'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Success message
                    example: Success
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: Signer not associated to this file
  '/sign/file_id/{fileId}/token':
    post:
      tags:
        - account
      summary: Request sign code
      description: Request code to sign file using fileId
      operationId: signFile#getTokenUsingFileId
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/fileIdParam'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Success message
                    example: Success
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: Signer not associated to this file
  /file:
    post:
      tags:
        - sign
      summary: Send a file
      description: Send a new file to Nextcloud and return the fileId to request to sign usign fileId
      operationId: File#send
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: filename
                  description: The name of file to sign
                file:
                  oneOf:
                    - type: object
                      properties:
                        url:
                          type: string
                          description: URL of file
                          example: 'https://github.com/LibreSign/libresign/raw/main/tests/fixtures/small_valid.pdf'
                    - type: object
                      properties:
                        base64:
                          type: string
                          format: base64
                          description: base64 of PDF file content
                          example: dGVzdA==
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: Success
                  name:
                    type: string
                    example: filename
                    description: The name of file to sign
                  id:
                    type: integer
                    description: Node id of a Nextcloud file
                    example: 2312
                  etag:
                    type: string
                  path:
                    type: string
                  type:
                    type: string
                required:
                  - message
                  - name
                  - id
                  - etag
                  - path
                  - type
  /file/list:
    get:
      tags:
        - sign
      summary: List all LibreSign files
      description: List all LibreSign files returning all informations about files
      operationId: File#list
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/limitParam'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    minItems: 0
                    items:
                      $ref: '#/components/schemas/libresignFile'
                  pagination:
                    $ref: '#/components/schemas/pagination'
  '/file/validate/uuid/{uuid}':
    get:
      tags:
        - sign validate
      summary: Validate a file using UUID
      description: Validate a file using file UUID returning file data.
      operationId: File#validateUuid
      parameters:
        - $ref: '#/components/parameters/uuidParam'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/libresignFileStatus'
                  - type: object
                    properties:
                      success:
                        type: boolean
                        enum:
                          - true
                        description: Uhuuu! Need true vale.
                      name:
                        type: string
                        example: filename
                      file:
                        type: string
                        description: URL to download signed file
                        example: 'http://cloud.test.coop/apps/libresign/pdf/46d30465-ae11-484b-aad5-327249a1e8ef'
                      fileId:
                        type: integer
                        description: Node id of a Nextcloud file
                        example: 2312
                      uuid:
                        type: string
                        format: uuid
                        description: Received from sign request
                      pages:
                        type: array
                        description: |-
                          List with all pages on image format.
                          This property only will be returned when the query param format=image
                        items:
                          $ref: '#/components/schemas/pdfPage'
                      visibleElements:
                        description: Visible elements on document
                        allOf:
                          - $ref: '#/components/schemas/signatureElement'
                          - $ref: '#/components/schemas/elementCoordinate'
                          - type: object
                            properties:
                              fileUserId:
                                type: string
                                nullable: true
                                description: Representative ID of relation between file and user
                                example: johndoe
                              elementId:
                                type: integer
                                minimum: 1
                                example: 1
                            required:
                              - elementId
                      signers:
                        type: array
                        items:
                          type: object
                          properties:
                            signed:
                              type: string
                              pattern: '\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
                              description: 'Signing date, when signed'
                              example: '2021-12-31 22:45:50'
                              nullable: true
                            displayName:
                              type: string
                              description: The person display name
                              nullable: true
                              example: John
                            fullName:
                              type: string
                              description: The person full name
                              example: John Doe
                              nullable: true
                            me:
                              type: boolean
                              description: It's me?
                              example: true
                            email:
                              type: string
                              format: email
                              description: Unique email to identify signer. This property will only exist when it is a request made by the person who requested the document to be signed.
                              example: user@test.coop
                            uid:
                              type: string
                              description: Nextcloud user id of who requested the file to be signed.
                              example: johndoe
                            fileUserId:
                              type: integer
                              description: Relation between file and user
                              example: 1
                          required:
                            - signed
                            - fullName
                            - me
                            - fileUserId
                      settings:
                        $ref: '#/components/schemas/signSettings'
                      messages:
                        type: array
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              enum:
                                - success
                                - info
                                - warning
                                - danger
                              description: Type of message
                            message:
                              type: string
                              description: Text of message
                required:
                  - success
                  - name
                  - file
                  - status
                  - settings
        '404':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure!
                  settings:
                    $ref: '#/components/schemas/signSettings'
                  action:
                    type: integer
                    description: Numeric code representing what action should be taken with the response
                    example: 200
                  errors:
                    type: array
                    items:
                      type: string
                  messages:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          enum:
                            - success
                            - info
                            - warning
                            - danger
                          description: Type of message
                        message:
                          type: string
                          description: Text of message
                required:
                  - success
                  - settings
                  - errors
                  - action
  '/file/validate/file_id/{fileId}':
    get:
      tags:
        - sign validate
      summary: Validate a file using Nextcloud node id
      description: Validate a file using Nextcloud node id.
      operationId: File#validateFileId
      parameters:
        - $ref: '#/components/parameters/fileIdParam'
      responses:
        '200':
          description: Success!
          content:
            image/png:
              schema:
                allOf:
                  - $ref: '#/components/schemas/libresignFileStatus'
                  - type: object
                    properties:
                      success:
                        type: boolean
                        enum:
                          - true
                        description: Uhuuu! Need true vale.
                      name:
                        type: string
                        example: filename
                      file:
                        type: string
                        description: URL to download signed file
                        example: 'http://cloud.test.coop/apps/libresign/pdf/46d30465-ae11-484b-aad5-327249a1e8ef'
                      fileId:
                        type: integer
                        description: Node id of a Nextcloud file
                        example: 2312
                      uuid:
                        type: string
                        format: uuid
                        description: Received from sign request
                      pages:
                        type: array
                        description: |-
                          List with all pages on image format.
                          This property only will be returned when the query param format=image
                        items:
                          $ref: '#/components/schemas/pdfPage'
                      visibleElements:
                        description: Visible elements on document
                        allOf:
                          - $ref: '#/components/schemas/signatureElement'
                          - $ref: '#/components/schemas/elementCoordinate'
                          - type: object
                            properties:
                              uid:
                                type: string
                                description: Nextcloud user id to assign this visible element.
                                example: johndoe
                                nullable: true
                              elementId:
                                type: integer
                                minimum: 1
                                example: 1
                            required:
                              - elementId
                      signers:
                        type: array
                        items:
                          type: object
                          properties:
                            signed:
                              type: string
                              pattern: '\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
                              description: 'Signing date, when signed'
                              example: '2021-12-31 22:45:50'
                              nullable: true
                            displayName:
                              type: string
                              description: The person display name
                              nullable: true
                              example: John
                            fullName:
                              type: string
                              description: The person full name
                              example: John Doe
                              nullable: true
                            me:
                              type: boolean
                              description: It's me?
                              example: true
                            email:
                              type: string
                              format: email
                              description: Unique email to identify signer. This property will only exist when it is a request made by the person who requested the document to be signed.
                              example: user@test.coop
                            uid:
                              type: string
                              description: Nextcloud user id of who requested the file to be signed.
                              example: johndoe
                            fileUserId:
                              type: integer
                              description: ID of relation between file and user. Each relation between file and user has an ID that is returned on validation endpoints.
                              example: 1
                          required:
                            - signed
                            - fullName
                            - me
                            - fileUserId
                      settings:
                        $ref: '#/components/schemas/signSettings'
                      messages:
                        type: array
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              enum:
                                - success
                                - info
                                - warning
                                - danger
                              description: Type of message
                            message:
                              type: string
                              description: Text of message
                required:
                  - success
                  - name
                  - file
                  - status
                  - settings
        '404':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure!
                  settings:
                    $ref: '#/components/schemas/signSettings'
                  action:
                    type: integer
                    description: Numeric code representing what action should be taken with the response
                    example: 200
                  errors:
                    type: array
                    items:
                      type: string
                  messages:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          enum:
                            - success
                            - info
                            - warning
                            - danger
                          description: Type of message
                        message:
                          type: string
                          description: Text of message
                required:
                  - success
                  - settings
                  - errors
                  - action
  '/file/page/{uuid}/{page}':
    get:
      tags:
        - sign
      summary: Returns the image of a pdf page
      description: Returns the image of a pdf page
      operationId: File#getPage
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/uuidParam'
        - name: page
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
          description: The number of page to return
      responses:
        '200':
          description: The image of page
          content:
            image/png:
              schema:
                type: string
                format: binary
        '404':
          description: Request failed
  '/file-element/{uuid}':
    post:
      tags:
        - sign
      summary: Create visible element
      description: Create visible element of a specific file
      operationId: File#post
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/uuidParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/pdfVisibleElement'
      responses:
        '200':
          description: Visible document saved with success
          content:
            application/json:
              schema:
                type: object
                properties:
                  fileElementId:
                    type: integer
                    description: 'Representative ID of relation between file, fileUser and the visible element on pdf'
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                required:
                  - success
                  - fileElementId
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure on generate certificate.
                  message:
                    type: string
                    description: Error pessage
                    example: Invalid file
                required:
                  - success
                  - message
  '/file-element/{uuid}/{elementId}':
    patch:
      tags:
        - sign
      summary: Update visible element
      description: Update visible element of a specific file
      operationId: File#patch
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/uuidParam'
        - $ref: '#/components/parameters/elementIdParam'
      requestBody:
        content:
          application/json:
            schema:
              not:
                required:
                  - coordinates
              allOf:
                - $ref: '#/components/schemas/pdfVisibleElement'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  fileElementId:
                    type: integer
                    description: 'Representative ID of relation between file, fileUser and the visible element on pdf'
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                required:
                  - success
                  - fileElementId
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Beep! Failure on update visible element.
                  message:
                    type: string
                    description: Error pessage
                    example: Invalid type
                required:
                  - success
                  - message
    delete:
      tags:
        - sign
      summary: Delete visible element
      description: Delete visible element of a specific file
      operationId: File#delete
      security:
        - basicAuth: []
      parameters:
        - $ref: '#/components/parameters/uuidParam'
        - $ref: '#/components/parameters/elementIdParam'
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Success message
                    example: Success
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Description of the failure that occurred
                    example: Element not associated to this file
  /notify/signers:
    post:
      tags:
        - sign
      summary: Notify signers of a file
      description: Notify signers of a file
      operationId: notify#signers
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                fileId:
                  type: integer
                  description: Node id of a Nextcloud file
                  example: 2312
                signers:
                  type: array
                  description: Collection of signers
                  items:
                    type: object
                    description: Signer who will notify
                    properties:
                      email:
                        type: string
                        format: email
                        description: Unique email to identify signer
                        example: user@test.coop
                    required:
                      - email
              required:
                - fileId
                - signers
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: Uhuuu! Need true vale.
                  message:
                    type: string
                    description: Success message
                    example: Success
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: Oh no!
                  messages:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          enum:
                            - success
                            - info
                            - warning
                            - danger
                          description: Type of message
                        message:
                          type: string
                          description: Text of message
                          example: Invalid type
  /setting/has-root-cert:
    get:
      tags:
        - admin
      summary: Has root certificate
      description: Checks whether the root certificate has been configured by checking the Nextcloud configuration table to see if the root certificate settings have been saved.
      operationId: setting#hasRootCert
      security:
        - basicAuth: []
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  hasRootCert:
                    type: boolean
                    example: true
  /admin/download-binaries:
    get:
      tags:
        - admin
      summary: Download binaries
      description: Download all binaries required to work
      operationId: admin#downloadBinaries
      security:
        - basicAuth: []
      responses:
        '200':
          description: Success!
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: Success
  /admin/configure-check:
    get:
      tags:
        - admin
      summary: Configure check
      description: Verify if all required to work fine is ok.
      operationId: admin#configureCheck
      security:
        - basicAuth: []
      responses:
        '200':
          description: List of settings and status
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  description: Check list
                  properties:
                    status:
                      type: string
                      description: The status of setting
                      example: 
                    message:
                      type: string
                      description: The setting text
                      example: Signature working fine
  /admin/certificate:
    post:
      tags:
        - admin
      summary: Create root certificate
      description: Create root certificate and enable execution of CFSSL
      operationId: admin#generateCertificate
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                commonName:
                  type: string
                  description: Common name
                  example: CommonName
                country:
                  type: string
                  description: Country name
                  example: Brazil
                organization:
                  type: string
                  description: Organization
                  example: Organization
                organizationUnit:
                  type: string
                  description: Organization unit
                  example: organizationUnit
                cfsslUri:
                  type: string
                  description: CFSSL service URL
                  example: 'http://cfssl:8888/api/v1/cfssl/'
                configPath:
                  type: string
                  description: The path that Nextcloud should save the CFSSL configuration files for and that the CFSSL service needs to read to generate the root certificate.
                  example: /cfssl/
              required:
                - commonName
                - country
                - organization
                - organizationUnit
                - cfsslUri
                - configPath
      responses:
        '200':
          description: 'If the response is successful, it is because the settings have been saved and the root certificate has been generated.'
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                    description: CFSSL server is up?
                required:
                  - success
                example:
                  success: true
        '401':
          description: Request failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - false
                    description: CFSSL server is up?
                  message:
                    type: array
                    description: List of failures that occurred
                required:
                  - success
                  - message
                example:
                  success: false
                  message:
                    - parameter 'cfsslUri' is required!
    get:
      tags:
        - admin
      summary: Get root certificate
      description: Get root certificate settings
      operationId: admin#loadCertificate
      security:
        - basicAuth: []
      responses:
        '200':
          description: The certificate settings
          content:
            application/json:
              schema:
                type: object
                properties:
                  commonName:
                    type: string
                    description: Common name
                    example: CommonName
                  country:
                    type: string
                    description: Country name
                    example: Brazil
                  organization:
                    type: string
                    description: Organization
                    example: Organization
                  organizationUnit:
                    type: string
                    description: Organization unit
                    example: organizationUnit
                  cfsslUri:
                    type: string
                    description: CFSSL service URL
                    example: 'http://cfssl:8888/api/v1/cfssl/'
                  configPath:
                    type: string
                    description: The path that Nextcloud should save the CFSSL configuration files for and that the CFSSL service needs to read to generate the root certificate.
                    example: /cfssl/
components:
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
  parameters:
    pageParam:
      name: page
      in: query
      schema:
        type: integer
        minimum: 0
      description: The number of page to return
    limitParam:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        default: 15
      description: The number of page to return
    fileIdParam:
      name: fileId
      in: path
      description: Node id of a Nextcloud file
      required: true
      schema:
        type: string
        description: Node id of a Nextcloud file.
        example: '564'
    uuidParam:
      name: uuid
      in: path
      description: File UUID
      required: true
      schema:
        type: string
        format: uuid
        description: UUID user file identifier. The user UUID is what the person receives via email when asked to sign. This is not the file UUID.
    elementIdParam:
      name: elementId
      in: path
      description: ID of visible element
      required: true
      schema:
        type: integer
        description: Each element has an ID that is returned on validation endpoints.
  schemas:
    basicAccount:
      type: object
      properties:
        displayName:
          type: string
          description: Who requested that the file be signed?
          nullable: true
          example: John Doe
        uid:
          type: string
          description: Nextcloud user id of who requested the file to be signed.
          example: johndoe
    signAccount:
      allOf:
        - $ref: '#/components/schemas/basicAccount'
        - type: object
          properties:
            email:
              type: string
              format: email
              description: Unique email to identify user. Use this or uid.
              example: user@test.coop
            description:
              type: string
              description: Description that will be displayed to the person
              example: 'As the company''s CEO, you must sign this contract'
    accountSettings:
      type: object
      properties:
        canRequestSign:
          type: boolean
          description: 'Person can request sign a new file. To authorize, the person must belong to a group defined in the LibreSign settings.'
          example: true
        hasSignatureFile:
          type: boolean
          description: Has signature file.
          example: true
    signSettings:
      type: object
      properties:
        canRequestSign:
          type: boolean
          description: 'Person can request sign a new file. To authorize, the person must belong to a group defined in the LibreSign settings.'
          example: true
        hasSignatureFile:
          type: boolean
          description: Has signature file.
          example: true
        canSign:
          type: boolean
          description: Can request sign this file
          example: true
        signerFileUuid:
          type: string
          format: uuid
          description: UUID of relation between user and file to sign. Only will be returned if the user that did the request need sign the file.
          nullable: true
        phoneNumber:
          description: User phone number when defined.
          type: string
        signMethod:
          type: string
          description: Defined method to sign file
          example: password
        needIdentificationDocuments:
          type: boolean
          description: need identification documents
          nullable: true
          example: true
        identificationDocumentsWaitingApproval:
          type: boolean
          description: identification documents waiting approval
          nullable: true
          example: true
    libresignFile:
      type: object
      properties:
        uuid:
          type: string
          format: uuid
          description: File identifier. It is necessary to keep it because it must be used to update or delete a signature request and will also be used in the callback request.
        name:
          type: string
          example: filename
          description: The name of file to sign
        callback:
          type: string
          description: URL that will receive a POST after the document is signed
          nullable: true
          example: 'http://app.test.coop/callback_webhook'
        status:
          type: integer
          enum:
            - 0
            - 1
            - 2
          description: >
            Numeric code of status
            * 0 - no signers
            * 1 - signed
            * 2 - pending
          example: 1
        status_text:
          type: string
          description: Translated text of status
          example: able to sign
        status_date:
          type: string
          format: date-time
          pattern: '\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
          nullable: true
          description: Last status date
          example: '2021-12-31 22:45:50'
        request_date:
          type: string
          format: date-time
          pattern: '\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
          nullable: true
          description: Date the file was requested to be signed
          example: '2021-12-31 22:45:50'
        requested_by:
          $ref: '#/components/schemas/basicAccount'
        file:
          type: object
          nullable: true
          properties:
            type:
              type: string
              enum:
                - pdf
              description: Type of file
              example: pdf
            url:
              type: string
              description: URL to view PDF
              example: 'http://cloud.test.coop/apps/libresign/pdf/46d30465-ae11-484b-aad5-327249a1e8ef'
            nodeId:
              type: integer
              description: Node id of a Nextcloud file
              example: 2312
          required:
            - type
        signers:
          type: array
          description: Collection of users who must sign the document
          items:
            type: object
            description: Person who will sign
            properties:
              email:
                type: string
                format: email
                description: Unique email to identify user
                example: user@test.coop
              me:
                type: boolean
                description: It's me?
                example: true
              sign_uuid:
                type: string
                format: uuid
                description: Received from sign request, only returned when me=true
              displayName:
                type: string
                nullable: true
                description: Persons name
                example: John Doe
              uid:
                type: string
                nullable: true
                description: Nextcloud user id of who requested the file to be signed when the person created account.
                example: johndoe
              description:
                type: string
                nullable: true
                description: Description that will be displayed to the person
                example: 'As the company''s CEO, you must sign this contract'
              sign_date:
                type: string
                format: date-time
                pattern: '\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
                nullable: true
                description: Date the file was signed
                example: '2021-12-31 22:45:50'
              request_sign_date:
                type: string
                format: date-time
                pattern: '\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
                description: Date the signature was requested
                example: '2021-12-31 22:45:50'
              fileUserId:
                type: integer
                description: ID of relation between file and user. Each relation between file and user has an ID that is returned on validation endpoints.
                example: 1
            required:
              - email
              - request_sign_date
      required:
        - uuid
        - name
        - status
    fileId:
      type: object
      description: File object.
      properties:
        fileId:
          type: integer
          description: Node id of a Nextcloud file
          example: 2312
      example:
        fileId: 2312
    newFile:
      type: object
      description: File object. Use one of these types
      oneOf:
        - type: object
          properties:
            url:
              type: string
              description: URL of file
              example: 'https://github.com/LibreSign/libresign/raw/main/tests/fixtures/small_valid.pdf'
        - $ref: '#/components/schemas/fileId'
        - type: object
          properties:
            base64:
              type: string
              format: base64
              description: base64 of PDF file content
              example: dGVzdA==
      x-examples:
        example-url:
          url: 'https://github.com/LibreSign/libresign/raw/main/tests/fixtures/small_valid.pdf'
    fileType:
      type: object
      description: Type of files
      properties:
        type:
          type: string
          description: Constant defining the type of file
          example: IDENTIFICATION
        name:
          type: string
          description: The name of file
          example: Identification Document
        description:
          type: string
          description: Description of file
          example: Identification Document
    pagination:
      type: object
      properties:
        total:
          type: integer
          minimum: 0
          description: Total number of records
          example: 300
        current:
          type: string
          minimum: 1
          nullable: true
          description: URL of current page
          example: /file/list?page=2&length=15
        next:
          type: string
          nullable: true
          description: URL of next page
          example: /file/list?page=3
        prev:
          type: string
          nullable: true
          description: URL of previous page
          example: /file/list?page=1
        last:
          type: string
          nullable: true
          description: URL of last page
          example: /file/list?page=20
        first:
          type: string
          nullable: true
          description: URL of first page
          example: /file/list?page=1
      required:
        - total
        - current
        - next
        - prev
        - last
        - first
    signatureElement:
      description: Visible elements to associate with the document
      type: object
      properties:
        type:
          type: string
          minLength: 1
          enum:
            - signature
            - initial
            - date
            - datetime
            - text
          example: signature
        file:
          $ref: '#/components/schemas/newFile'
      required:
        - type
    signatureMetadataElement:
      description: Metadata of visible elements to associate with the document
      type: object
      example:
        metadata:
          text: Lorem ipsum
      properties:
        metadata:
          type: object
          properties:
            text:
              type: string
              minLength: 1
            dateFormat:
              type: string
              minLength: 1
    elementCoordinate:
      description: Coortinates of a visible element on PDF
      type: object
      x-examples:
        example-1:
          coordinates:
            page: 0
            urx: 0
            ury: 0
            llx: 0
            lly: 0
        example-2:
          coordinates:
            page: 0
            width: 0
            height: 0
            left: 0
            top: 0
      properties:
        coordinates:
          type: object
          properties:
            page:
              type: integer
              example: 0
              minimum: 0
              default: 1
            width:
              type: integer
              description: width of visible signature
              minimum: 0
              example: 0
              default: 0
            height:
              type: integer
              description: height of visible signature
              minimum: 0
              example: 0
              default: 0
            left:
              type: integer
              description: left position of visible signature
              minimum: 0
              example: 0
              default: 0
            top:
              type: integer
              description: top position of visible signature
              minimum: 0
              example: 0
              default: 0
            urx:
              type: integer
              description: upper right corner postion on X-axe of visible signature
              minimum: 0
              example: 0
              default: 0
            ury:
              type: integer
              description: upper right corner postion on Y-axe of visible signature
              minimum: 0
              example: 0
              default: 0
            llx:
              type: integer
              description: lower left corner postion on X-axe of visible signature
              minimum: 0
              example: 0
              default: 0
            lly:
              type: integer
              description: lower left corner postion on Y-axe of visible signature
              minimum: 0
              example: 0
              default: 0
      required:
        - coordinates
    pdfVisibleElement:
      description: Coortinates of a visible element on PDF
      type: object
      x-examples:
        Example of new element:
          type: signature
          metadata:
            text: Lorem ipsum
          coordinates:
            page: 0
            urx: 0
            ury: 0
            llx: 0
            lly: 0
          fileUserId: 123
      not:
        required:
          - coordinates
      allOf:
        - $ref: '#/components/schemas/signatureMetadataElement'
        - $ref: '#/components/schemas/elementCoordinate'
        - type: object
          properties:
            type:
              type: string
              minLength: 1
              enum:
                - signature
                - initial
                - date
                - datetime
                - text
              example: signature
            fileUserId:
              type: integer
              description: 'Representative ID of relation between file, fileUser and the visible element on pdf'
              example: 123
          required:
            - fileUserId
    pdfPage:
      type: object
      description: Metadata of PDF page on image format
      properties:
        url:
          type: string
          description: URL of page
          example: 'http://cloud.test.coop/apps/libresign/img/46d30465-ae11-484b-aad5-327249a1e8ef/page/1'
        resolution:
          type: object
          required:
            - w
            - h
          properties:
            w:
              type: number
              description: Width in pixels of page
              example: 200.5
            h:
              type: number
              description: Height in pixels of page
              example: 200.5
      required:
        - url
        - resolution
    libresignFileStatus:
      title: LibreSign file status
      type: object
      properties:
        statusText:
          type: string
          description: Status human readdable
          example: able to sign
        status:
          type: integer
          description: |-
            Numeric code of signature status

            STATUS_DRAFT = 0
            STATUS_ABLE_TO_SIGN = 1
            STATUS_PARTIAL_SIGNED = 2
            STATUS_SIGNED = 3
            STATUS_DELETED = 4
          enum:
            - 0
            - 1
            - 2
            - 3
            - 4
          default: 1
